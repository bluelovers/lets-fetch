import * as fetch from './index';
import { ResponseError } from './index';
import Bluebird from 'bluebird';
let reqResponses = [];
let reqOptions = [];
let reqUrls = [];
let mockingEnabled = true;
export function addResponse(content) {
    reqResponses.push(content);
}
export function addResponseError(response, content) {
    const responseError = new ResponseError(response, content);
    reqResponses.push(responseError);
}
export function reset() {
    reqResponses = [];
    reqOptions = [];
    reqUrls = [];
    fetch.retry(() => false);
}
export function urls() {
    return reqUrls;
}
export function options() {
    return reqOptions;
}
export function lastUrl() {
    return reqUrls[reqUrls.length - 1];
}
export function lastOption() {
    return reqOptions[reqOptions.length - 1];
}
export function enableMocking(bool) {
    mockingEnabled = bool;
}
export function single(url, opt) {
    reqUrls.push(url);
    reqOptions.push(opt);
    if (!mockingEnabled) {
        return fetch.single(url, opt);
    }
    return new Bluebird((resolve, reject) => {
        let response = reqResponses.shift();
        if (response instanceof Error) {
            return reject(response);
        }
        resolve(response);
    });
}
export function many(urls, opt) {
    if (!mockingEnabled) {
        reqUrls = reqUrls.concat(urls);
        reqOptions = reqOptions.concat(opt);
        return fetch.many(urls, opt);
    }
    return Bluebird.resolve(urls).map(url => single(url, opt));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9jay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2NrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sU0FBUyxDQUFBO0FBQ2hDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDeEMsT0FBTyxRQUFRLE1BQU0sVUFBVSxDQUFBO0FBRy9CLElBQUksWUFBWSxHQUFzQyxFQUFFLENBQUE7QUFDeEQsSUFBSSxVQUFVLEdBQWUsRUFBRSxDQUFBO0FBQy9CLElBQUksT0FBTyxHQUFhLEVBQUUsQ0FBQTtBQUMxQixJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUE7QUFJekIsTUFBTSxVQUFVLFdBQVcsQ0FBQyxPQUFPO0lBRWxDLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7QUFDM0IsQ0FBQztBQUVELE1BQU0sVUFBVSxnQkFBZ0IsQ0FBSSxRQUF1QixFQUFFLE9BQVU7SUFFdEUsTUFBTSxhQUFhLEdBQUcsSUFBSSxhQUFhLENBQUMsUUFBZSxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBRWpFLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUE7QUFDakMsQ0FBQztBQUVELE1BQU0sVUFBVSxLQUFLO0lBRXBCLFlBQVksR0FBRyxFQUFFLENBQUE7SUFDakIsVUFBVSxHQUFHLEVBQUUsQ0FBQTtJQUNmLE9BQU8sR0FBRyxFQUFFLENBQUE7SUFDWixLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ3pCLENBQUM7QUFFRCxNQUFNLFVBQVUsSUFBSTtJQUVuQixPQUFPLE9BQU8sQ0FBQTtBQUNmLENBQUM7QUFFRCxNQUFNLFVBQVUsT0FBTztJQUV0QixPQUFPLFVBQVUsQ0FBQTtBQUNsQixDQUFDO0FBRUQsTUFBTSxVQUFVLE9BQU87SUFFdEIsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUNuQyxDQUFDO0FBRUQsTUFBTSxVQUFVLFVBQVU7SUFFekIsT0FBTyxVQUFVLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUN6QyxDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWEsQ0FBQyxJQUFhO0lBRTFDLGNBQWMsR0FBRyxJQUFJLENBQUE7QUFDdEIsQ0FBQztBQUVELE1BQU0sVUFBVSxNQUFNLENBQUksR0FBVyxFQUFFLEdBQWM7SUFFcEQsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUNqQixVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBRXBCLElBQUksQ0FBQyxjQUFjLEVBQ25CO1FBQ0MsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFJLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtLQUNoQztJQUVELE9BQU8sSUFBSSxRQUFRLENBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFFMUMsSUFBSSxRQUFRLEdBQUcsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFBO1FBRW5DLElBQUksUUFBUSxZQUFZLEtBQUssRUFDN0I7WUFDQyxPQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTtTQUN2QjtRQUVELE9BQU8sQ0FBQyxRQUFvQixDQUFDLENBQUE7SUFDOUIsQ0FBQyxDQUFDLENBQUE7QUFDSCxDQUFDO0FBRUQsTUFBTSxVQUFVLElBQUksQ0FBc0IsSUFBYyxFQUFFLEdBQWM7SUFFdkUsSUFBSSxDQUFDLGNBQWMsRUFDbkI7UUFDQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUM5QixVQUFVLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNuQyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUksSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0tBQy9CO0lBRUQsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQWdCLENBQUE7QUFDMUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZldGNoIGZyb20gJy4vaW5kZXgnXG5pbXBvcnQgeyBSZXNwb25zZUVycm9yIH0gZnJvbSAnLi9pbmRleCc7XG5pbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnXG5pbXBvcnQgeyBJT3B0aW9ucyB9IGZyb20gJy4vaW5kZXgnO1xuXG5sZXQgcmVxUmVzcG9uc2VzOiAoSU1vY2tSZXNwb25zZSB8IFJlc3BvbnNlRXJyb3IpW10gPSBbXVxubGV0IHJlcU9wdGlvbnM6IElPcHRpb25zW10gPSBbXVxubGV0IHJlcVVybHM6IHN0cmluZ1tdID0gW11cbmxldCBtb2NraW5nRW5hYmxlZCA9IHRydWVcblxudHlwZSBJTW9ja1Jlc3BvbnNlID0gUGFydGlhbDxSZXNwb25zZT5cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFJlc3BvbnNlKGNvbnRlbnQpXG57XG5cdHJlcVJlc3BvbnNlcy5wdXNoKGNvbnRlbnQpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRSZXNwb25zZUVycm9yPFQ+KHJlc3BvbnNlOiBJTW9ja1Jlc3BvbnNlLCBjb250ZW50OiBUKVxue1xuXHRjb25zdCByZXNwb25zZUVycm9yID0gbmV3IFJlc3BvbnNlRXJyb3IocmVzcG9uc2UgYXMgYW55LCBjb250ZW50KVxuXG5cdHJlcVJlc3BvbnNlcy5wdXNoKHJlc3BvbnNlRXJyb3IpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNldCgpXG57XG5cdHJlcVJlc3BvbnNlcyA9IFtdXG5cdHJlcU9wdGlvbnMgPSBbXVxuXHRyZXFVcmxzID0gW11cblx0ZmV0Y2gucmV0cnkoKCkgPT4gZmFsc2UpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cmxzKClcbntcblx0cmV0dXJuIHJlcVVybHNcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9wdGlvbnMoKVxue1xuXHRyZXR1cm4gcmVxT3B0aW9uc1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbGFzdFVybCgpXG57XG5cdHJldHVybiByZXFVcmxzW3JlcVVybHMubGVuZ3RoIC0gMV1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxhc3RPcHRpb24oKVxue1xuXHRyZXR1cm4gcmVxT3B0aW9uc1tyZXFPcHRpb25zLmxlbmd0aCAtIDFdXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVNb2NraW5nKGJvb2w6IGJvb2xlYW4pXG57XG5cdG1vY2tpbmdFbmFibGVkID0gYm9vbFxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2luZ2xlPFQ+KHVybDogc3RyaW5nLCBvcHQ/OiBJT3B0aW9ucylcbntcblx0cmVxVXJscy5wdXNoKHVybClcblx0cmVxT3B0aW9ucy5wdXNoKG9wdClcblxuXHRpZiAoIW1vY2tpbmdFbmFibGVkKVxuXHR7XG5cdFx0cmV0dXJuIGZldGNoLnNpbmdsZTxUPih1cmwsIG9wdClcblx0fVxuXG5cdHJldHVybiBuZXcgQmx1ZWJpcmQ8VD4oKHJlc29sdmUsIHJlamVjdCkgPT5cblx0e1xuXHRcdGxldCByZXNwb25zZSA9IHJlcVJlc3BvbnNlcy5zaGlmdCgpXG5cblx0XHRpZiAocmVzcG9uc2UgaW5zdGFuY2VvZiBFcnJvcilcblx0XHR7XG5cdFx0XHRyZXR1cm4gcmVqZWN0KHJlc3BvbnNlKVxuXHRcdH1cblxuXHRcdHJlc29sdmUocmVzcG9uc2UgYXMgYW55IGFzIFQpXG5cdH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYW55PFQgZXh0ZW5kcyB1bmtub3duW10+KHVybHM6IHN0cmluZ1tdLCBvcHQ/OiBJT3B0aW9ucyk6IEJsdWViaXJkPFQ+XG57XG5cdGlmICghbW9ja2luZ0VuYWJsZWQpXG5cdHtcblx0XHRyZXFVcmxzID0gcmVxVXJscy5jb25jYXQodXJscylcblx0XHRyZXFPcHRpb25zID0gcmVxT3B0aW9ucy5jb25jYXQob3B0KVxuXHRcdHJldHVybiBmZXRjaC5tYW55PFQ+KHVybHMsIG9wdClcblx0fVxuXG5cdHJldHVybiBCbHVlYmlyZC5yZXNvbHZlKHVybHMpLm1hcCh1cmwgPT4gc2luZ2xlKHVybCwgb3B0KSkgYXMgQmx1ZWJpcmQ8VD5cbn1cbiJdfQ==